{% extends "base.html" %}
{% load static %}

{% block header %}
<h2 class="display-title text-center py-3">Admin Dashboard</h2>
{% endblock %}

{% block content %}

<div class="row g-4">
    <div class="col-md-4">
        <div class="card-modern p-4 text-center">
            <div class="kpi-number">{{ total_voters }}</div>
            <div class="kpi-label">Total Voters</div>
            <p class="text-muted">Manage voters, activate/deactivate accounts.</p>
            <a href="{% url 'user_list' %}" class="btn btn-primary btn-sm">Manage Users</a>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card-modern p-4 text-center">
            <div class="kpi-number">{{ total_candidates }}</div>
            <div class="kpi-label">Total Candidates</div>
            <p class="text-muted">Approve and register candidates for elections.</p>
            <a href="{% url 'candidate_list' %}" class="btn btn-primary btn-sm">Manage Candidates</a>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card-modern p-4 text-center">
            <div class="kpi-number">{{ active_elections }}</div>
            <div class="kpi-label">Active Elections</div>
            <p class="text-muted">Create, update and publish elections.</p>
            <a href="{% url 'election_list' %}" class="btn btn-primary btn-sm">Manage Elections</a>
        </div>
    </div>
</div>

<div class="row g-4 mt-3">
    <div class="col-md-4">
        <div class="card-modern p-4 text-center">
            <div class="kpi-number">{{ votes_cast }}</div>
            <div class="kpi-label">Votes Cast</div>
            <p class="text-muted">Total votes recorded across all elections.</p>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card-modern p-4 text-center">
            <div class="kpi-number">{{ pending_verifications }}</div>
            <div class="kpi-label">Pending Verifications</div>
            <p class="text-muted">Candidates awaiting admin approval.</p>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card-modern p-4 text-center">
            <div class="kpi-number">{{ results_ready }}</div>
            <div class="kpi-label">Elections Ready</div>
            <p class="text-muted">Elections that have ended and may have results.</p>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card shadow-sm border-warning">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0 fw-bold">‚ö†Ô∏è Pending Results Publication</h5>
            </div>
            <div class="card-body">
                {% if concluded_unpublished_elections %}
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th>Election Title</th>
                                    <th>Ended On</th>
                                    <th class="text-end">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for election in concluded_unpublished_elections %}
                                <tr>
                                    <td><strong>{{ election.title }}</strong></td>
                                    <td>{{ election.end_date|date:"M d, Y H:i" }}</td>
                                    <td class="text-end">
                                        <form action="{% url 'publish_results' election.id %}" method="POST" style="display:inline;">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-success btn-sm fw-bold">
                                                Publish Results üöÄ
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-muted mb-0">No concluded elections are waiting for publication.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mt-3">
    <div class="col-md-4">
        <div class="card-modern p-4 text-center">
            <h5 class="fw-bold">View Results</h5>
            <p class="text-muted">Check final election results instantly.</p>
            <a href="{% url 'results_overview' %}" class="btn btn-primary btn-sm">Open</a>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card-modern p-4 text-center">
            <h5 class="fw-bold">Audit Logs</h5>
            <p class="text-muted">Track all activities and system operations.</p>
            <a href="{% url 'audit_list' %}" class="btn btn-primary btn-sm">Open</a>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card-modern p-4 text-center">
            <h5 class="fw-bold">Backup & Restore</h5>
            <p class="text-muted">Database backup and restoration.</p>
            <a href="{% url 'backups_list' %}" class="btn btn-primary btn-sm">Open</a>
        </div>
    </div>
</div>

{% endblock %}